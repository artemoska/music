<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubeton Music Player - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/react-jinke-music-player@4.27.2/assets/index.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 40px 20px; margin-bottom: 30px; background: rgba(0,0,0,0.3); border-radius: 20px; }
        h1 { font-size: 3em; margin-bottom: 10px; background: linear-gradient(90deg, #00dbde, #fc00ff); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .player-container { background: rgba(0,0,0,0.5); border-radius: 15px; padding: 20px; margin-bottom: 30px; min-height: 500px; }
        .instructions { background: rgba(255,255,255,0.05); border-radius: 10px; padding: 25px; margin-top: 40px; border-left: 4px solid #00dbde; }
        .track-item { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; }
        footer { text-align: center; margin-top: 40px; padding: 20px; opacity: 0.7; }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .alert { padding: 15px; border-radius: 10px; margin: 10px 0; }
        .alert-success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4CAF50; }
        .alert-error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .alert-info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196F3; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { background: linear-gradient(90deg, #00dbde, #fc00ff); color: white; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; margin: 5px; }
        .btn:hover { opacity: 0.9; }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loader { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #00dbde; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @media (max-width: 768px) { h1 { font-size: 2em; } .container { padding: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ Rubeton Music Player</h1>
            <p>–ü—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∏ MP3 –≤ –ø–∞–ø–∫—É music/</p>
        </header>
        
        <div id="alerts"></div>
        
        <div class="player-container">
            <div id="player-loading">
                <div class="loader"></div>
                <p style="text-align: center; margin-top: 10px;">–ó–∞–≥—Ä—É–∂–∞—é –ø–ª–µ–µ—Ä...</p>
            </div>
            <div id="music-player" style="display: none;"></div>
        </div>
        
        <div id="track-list" style="display: none;">
            <h3>–í—Å–µ —Ç—Ä–µ–∫–∏:</h3>
            <div id="track-list-container"></div>
        </div>
        
        <div class="instructions">
            <h3>üìå –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</h3>
            <p>1. –ó–∞–≥—Ä—É–∑–∏ MP3 —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É <code>music/</code> (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è!)</p>
            <p>2. –û–±–ª–æ–∂–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≤ <code>music/covers/</code> —Å —Ç–∞–∫–∏–º –∂–µ –∏–º–µ–Ω–µ–º</p>
            <p>3. –§–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –ø–ª–µ–µ—Ä–µ</p>
            
            <div style="margin-top: 20px;">
                <button class="btn" onclick="loadDemoTracks()">üéµ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ-—Ç—Ä–µ–∫–∏</button>
                <button class="btn" onclick="refreshPlayer()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
        </div>
        
        <footer>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–ª–µ–µ—Ä ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GitHub Pages</p>
            <p>–¢–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: <span id="repo-name">artemoska/music</span></p>
        </footer>
    </div>

    <!-- React –∏ –ø–ª–µ–µ—Ä -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-jinke-music-player@4.27.2/dist/react-jinke-music-player.umd.js"></script>
    
    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –†–ï–ü–û–ó–ò–¢–û–†–ò–Ø
            getRepo: function() {
                const host = window.location.hostname;
                const path = window.location.pathname;
                
                // –ï—Å–ª–∏ –Ω–∞ github.io
                if (host.includes('github.io')) {
                    const match = path.match(/^\/([^\/]+)/);
                    if (match) return `artemoska/${match[1]}`;
                }
                
                // –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
                return 'artemoska/music';
            },
            
            // –ü–†–Ø–ú–´–ï –°–°–´–õ–ö–ò –ù–ê RAW –§–ê–ô–õ–´
            getRawUrl: function(filePath) {
                const repo = this.getRepo();
                return `https://raw.githubusercontent.com/${repo}/main/${filePath}`;
            },
            
            // GitHub API –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            getApiUrl: function(path) {
                const repo = this.getRepo();
                return `https://api.github.com/repos/${repo}/contents/${path}`;
            }
        };
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showAlert(message, type = 'info') {
            const alerts = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            alerts.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }
        
        // üìÅ –§–£–ù–ö–¶–ò–Ø: –°–∫–∞–Ω–∏—Ä—É–µ–º –ø–∞–ø–∫—É music/
        async function scanMusicFolder() {
            showAlert('üîç –°–∫–∞–Ω–∏—Ä—É—é –ø–∞–ø–∫—É music/...', 'info');
            
            try {
                const apiUrl = CONFIG.getApiUrl('music');
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        showAlert('–ü–∞–ø–∫–∞ music/ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –°–æ–∑–¥–∞–π—Ç–µ –µ—ë –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ MP3 —Ñ–∞–π–ª—ã.', 'error');
                        return [];
                    }
                    throw new Error(`GitHub API: ${response.status}`);
                }
                
                const files = await response.json();
                const mp3Files = files.filter(file => 
                    file.name.toLowerCase().endsWith('.mp3') && 
                    file.type === 'file'
                );
                
                showAlert(`üéµ –ù–∞–π–¥–µ–Ω–æ ${mp3Files.length} MP3 —Ñ–∞–π–ª–æ–≤`, 'success');
                
                // –ü–æ–ª—É—á–∞–µ–º –æ–±–ª–æ–∂–∫–∏
                const covers = await getCovers();
                
                // –°–æ–∑–¥–∞—ë–º –ø–ª–µ–π–ª–∏—Å—Ç
                return await createPlaylist(mp3Files, covers);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                showAlert('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é –¥–µ–º–æ-—Ç—Ä–µ–∫–∏', 'error');
                return getDemoPlaylist();
            }
        }
        
        // üñºÔ∏è –§–£–ù–ö–¶–ò–Ø: –ü–æ–ª—É—á–∞–µ–º –æ–±–ª–æ–∂–∫–∏
        async function getCovers() {
            try {
                const apiUrl = CONFIG.getApiUrl('music/covers');
                const response = await fetch(apiUrl);
                
                if (!response.ok) return {};
                
                const files = await response.json();
                const covers = {};
                
                files.forEach(file => {
                    if (file.type === 'file') {
                        const name = file.name.replace(/\.[^/.]+$/, '').toLowerCase();
                        covers[name] = CONFIG.getRawUrl(`music/covers/${file.name}`);
                    }
                });
                
                return covers;
            } catch (error) {
                return {};
            }
        }
        
        // üéµ –§–£–ù–ö–¶–ò–Ø: –°–æ–∑–¥–∞—ë–º –ø–ª–µ–π–ª–∏—Å—Ç
        async function createPlaylist(mp3Files, covers) {
            const playlist = [];
            
            for (const file of mp3Files) {
                const track = await createTrack(file, covers);
                if (track) playlist.push(track);
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∏–º–µ–Ω–∏
            playlist.sort((a, b) => a.name.localeCompare(b.name));
            return playlist;
        }
        
        // üìÑ –§–£–ù–ö–¶–ò–Ø: –°–æ–∑–¥–∞—ë–º —Ç—Ä–µ–∫
        async function createTrack(file, covers) {
            const nameWithoutExt = file.name.replace(/\.mp3$/i, '');
            const rawUrl = CONFIG.getRawUrl(`music/${file.name}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã
            if (/[–∞-—è–ê-–Ø]/.test(file.name)) {
                console.warn(`–†—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏: ${file.name}`);
            }
            
            // –û–±–ª–æ–∂–∫–∞
            let coverUrl = 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=400&fit=crop';
            const coverName = nameWithoutExt.toLowerCase();
            if (covers[coverName]) {
                coverUrl = covers[coverName];
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            const duration = await getAudioDuration(rawUrl);
            
            return {
                name: nameWithoutExt,
                singer: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
                cover: coverUrl,
                musicSrc: rawUrl,
                duration: duration,
                file: file.name
            };
        }
        
        // ‚è±Ô∏è –§–£–ù–ö–¶–ò–Ø: –ü–æ–ª—É—á–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ
        function getAudioDuration(url) {
            return new Promise((resolve) => {
                const audio = new Audio();
                audio.src = url;
                audio.onloadedmetadata = () => {
                    resolve(Math.round(audio.duration));
                };
                audio.onerror = () => {
                    resolve(0);
                };
            });
        }
        
        // üéß –§–£–ù–ö–¶–ò–Ø: –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-—Ç—Ä–µ–∫–∏
        function getDemoPlaylist() {
            return [
                {
                    name: "–î–µ–º–æ —Ç—Ä–µ–∫ 1",
                    singer: "–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
                    cover: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400&h=400&fit=crop",
                    musicSrc: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                    duration: 203
                },
                {
                    name: "–î–µ–º–æ —Ç—Ä–µ–∫ 2",
                    singer: "–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
                    cover: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400&h=400&fit=crop",
                    musicSrc: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                    duration: 189
                }
            ];
        }
        
        // üéÆ –§–£–ù–ö–¶–ò–Ø: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–µ–µ—Ä–∞
        function initPlayer(audioList) {
            if (!window.ReactJkMusicPlayer || !window.ReactJkMusicPlayer.default) {
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–µ—Ä–∞. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
                return;
            }
            
            document.getElementById('player-loading').style.display = 'none';
            document.getElementById('music-player').style.display = 'block';
            
            const Player = window.ReactJkMusicPlayer.default;
            
            const playerElement = React.createElement(Player, {
                audioLists: audioList,
                theme: 'dark',
                mode: 'full',
                autoPlay: false,
                responsive: true,
                showMediaSession: true,
                toggleMode: true,
                showThemeSwitch: true,
                showPlayMode: true,
                showDownload: false,
                showLyric: false,
                defaultPlayMode: 'order',
                quietUpdate: true,
                clearPriorAudioLists: true,
                autoPlayInitLoadPlayList: false,
                mobileMediaQuery: '(max-width: 768px)',
                defaultPosition: { bottom: '100px', right: '50px' }
            });
            
            ReactDOM.render(playerElement, document.getElementById('music-player'));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
            renderTrackList(audioList);
            document.getElementById('track-list').style.display = 'block';
            
            showAlert(`‚úÖ –ü–ª–µ–µ—Ä –≥–æ—Ç–æ–≤! ${audioList.length} —Ç—Ä–µ–∫–æ–≤`, 'success');
            document.getElementById('repo-name').textContent = CONFIG.getRepo();
        }
        
        // üìã –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤
        function renderTrackList(audioList) {
            const container = document.getElementById('track-list-container');
            
            if (audioList.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">–ù–µ—Ç —Ç—Ä–µ–∫–æ–≤. –ó–∞–≥—Ä—É–∑–∏ MP3 –≤ –ø–∞–ø–∫—É music/</p>';
                return;
            }
            
            const items = audioList.map((track, index) => `
                <div class="track-item" onclick="playTrack(${index})" style="cursor: pointer;">
                    <div style="margin-right: 15px; color: #00dbde;">${index + 1}</div>
                    <div>
                        <strong>${track.name}</strong><br>
                        <small>${track.singer} ‚Ä¢ ${track.duration ? formatTime(track.duration) : '--:--'}</small>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = items;
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        function playTrack(index) {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç—Ä–µ–∫ –≤ –ø–ª–µ–µ—Ä–µ
            const player = document.querySelector('.music-player-audio');
            if (player) {
                // –ü–ª–µ–µ—Ä —Å–∞–º –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∏–∫
            }
        }
        
        // üéµ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–º–æ-—Ç—Ä–µ–∫–æ–≤
        function loadDemoTracks() {
            showAlert('–ó–∞–≥—Ä—É–∂–∞—é –¥–µ–º–æ-—Ç—Ä–µ–∫–∏...', 'info');
            const demo = getDemoPlaylist();
            initPlayer(demo);
        }
        
        function refreshPlayer() {
            location.reload();
        }
        
        // üöÄ –ó–ê–ü–£–°–ö –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // 1. –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ React –∏ –ø–ª–µ–µ—Ä–∞
                await waitForDependencies();
                
                // 2. –°–∫–∞–Ω–∏—Ä—É–µ–º –ø–∞–ø–∫—É —Å –º—É–∑—ã–∫–æ–π
                const playlist = await scanMusicFolder();
                
                // 3. –ï—Å–ª–∏ –Ω–µ—Ç —Ç—Ä–µ–∫–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ
                if (playlist.length === 0) {
                    showAlert('–ù–µ—Ç MP3 —Ñ–∞–π–ª–æ–≤. –ò—Å–ø–æ–ª—å–∑—É—é –¥–µ–º–æ-—Ç—Ä–µ–∫–∏.', 'info');
                    initPlayer(getDemoPlaylist());
                } else {
                    // 4. –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–µ–µ—Ä —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ —Ç—Ä–µ–∫–∞–º–∏
                    initPlayer(playlist);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showAlert('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞. –ò—Å–ø–æ–ª—å–∑—É—é –¥–µ–º–æ-–≤–µ—Ä—Å–∏—é.', 'error');
                initPlayer(getDemoPlaylist());
            }
        });
        
        // ‚è≥ –§–£–ù–ö–¶–ò–Ø: –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
        function waitForDependencies() {
            return new Promise((resolve) => {
                const check = () => {
                    if (window.React && window.ReactDOM && window.ReactJkMusicPlayer) {
                        resolve();
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }
    </script>
</body>
</html>
